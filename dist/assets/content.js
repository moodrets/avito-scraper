let w=null;const o={profileName:".desktop-1r4tu1s",profileReviewsCount:".desktop-fgq05w",profileRating:'[data-marker="profile/score"]',profileSubscribers:'[data-marker="favorite-seller-counters"]',profileDeviveryInfo:".Sidebar-root-h24MJ .ProfileBadge-root-bcR8G:nth-child(2)",reviewsItem:".style-snippet-E6g8Y",reviewsItemProductName:".desktop-35wlrd",reviewsItemDateDelivery:".desktop-11ffzh3",reviewsItemRatingStars:".RatingStars-root-Edhhx .Attributes-yellow-star-PY9XT",reviewsMoreLoadButton:'[data-marker="rating-list/moreReviewsButton"]'};async function i(t){await chrome.runtime.sendMessage(t)}async function d(t){return new Promise(e=>{setTimeout(()=>{e(!0)},t)})}function u(){window.scrollTo({left:0,top:document.body.scrollHeight,behavior:"smooth"})}async function f(t){const e=document.querySelector(o.profileName),r=document.querySelector(o.profileReviewsCount),s=document.querySelector(o.profileRating),n=document.querySelector(o.profileSubscribers),a=document.querySelector(o.profileDeviveryInfo),c={createdDate:Date.now(),createdDateFormatted:new Date().toLocaleString("ru-RU"),name:(e==null?void 0:e.textContent)||"Информация не найдена",rating:(s==null?void 0:s.textContent)||"Информация не найдена",reviewsCount:(r==null?void 0:r.textContent)||"Информация не найдена",subscribers:(n==null?void 0:n.textContent)||"Информация не найдена",deliveryInfo:(a==null?void 0:a.textContent)||"Информация не найдена",existsInDataBase:!1,url:t.profileLink};await i({toastType:"success",toastText:"Получена информация профиля",profileInform:c})}const y={getDateOrDeliveryText(t,e){let r=t.split(",");return r[0]&&e==="date"?r[0]:r[1]&&e==="delivery"?r[1]:null},makeMonthNumberFromText(t){let e="";switch(t){case"января":e="01";break;case"февраля":e="02";break;case"марта":e="03";break;case"апреля":e="04";break;case"мая":e="05";break;case"июня":e="06";break;case"июля":e="07";break;case"августа":e="08";break;case"сентября":e="09";break;case"октября":e="10";break;case"ноября":e="11";break;case"декабря":e="12";break}return e},makeDateFromString(t){if(t.trim()==="сегодня")return Date.now();if(t.trim()==="вчера")return new Date().setDate(new Date().getDate()-1);let e=t.split(" "),r=e[0],s=this.makeMonthNumberFromText(e[1]),n=e[2]||`${new Date().getFullYear()}`;return Date.parse(`${n} ${s} ${r}`)},loadMoreButton(){return document.querySelector(o.reviewsMoreLoadButton)},async parseItems(){const t=[],e=document.querySelectorAll(o.reviewsItem);if(!e.length){await i({action:"reviews-parsing-ended",toastType:"error",toastText:"Отзывы не найдены"});return}console.log(w),e.forEach(r=>{const s=r.querySelectorAll(o.reviewsItemRatingStars),n=r.querySelector(o.reviewsItemProductName),a=r.querySelector(o.reviewsItemDateDelivery);let c=null,l=null,m=null;a!=null&&a.textContent&&(l=this.getDateOrDeliveryText(a.textContent,"date")),a!=null&&a.textContent&&(c=this.getDateOrDeliveryText(a.textContent,"delivery")),l&&(m=this.makeDateFromString(l)),t.push({date:m||"Информация не найдена",dateText:l||"Информация не найдена",delivery:!!c,productName:(n==null?void 0:n.textContent)||"Информация не найдена",rating:(s==null?void 0:s.length)||"Информация не найдена"})}),await i({action:"reviews-parsing-ended",toastType:"success",toastText:"Парсинг отзывов завершен",parsedReviewsList:t})},async loadMoreOnPage(){u(),await d(2e3);const t=this.loadMoreButton();if(t&&(t==null||t.click(),this.loadMoreOnPage()),!t){if(await d(2e3),this.loadMoreButton()){this.loadMoreOnPage();return}u(),this.parseItems()}},async parsingStart(){await i({action:"reviews-parsing-started",toastType:"success",toastText:"Парсинг отзывов запущен"}),u(),await d(2e3),u(),this.loadMoreOnPage()}};chrome.runtime.onMessage.addListener(async({action:t,filterFields:e})=>{if(!e){await i({toastType:"success",toastText:"Страница не получила поля фильтра"});return}t==="reviews-parsing-start"&&e&&(w=e,f(e),y.parsingStart())});
